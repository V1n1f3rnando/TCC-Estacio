@model IEnumerable<Oficina.Com.Models.FornecedorViewModel>
@{
    ViewBag.Title = "ConsultarFornecedor";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>ConsultarFornecedor</h2>

<div class="alert-messages text-center">
</div>
<br />
<a href="" onclick="modalcreate" data-toggle="modal" data-target="#modalcreateFornecedor">
    <span class="mdi mdi-account btn btn-success"> Nova Fornecedor</span>
</a>
<hr />

<div class="col-md-12">
    <table class="table table-striped table-bordered" cellspacing="0" id="tbconsulta" style="width:100%">
        <thead>
            <tr>
                <th>Cnpj</th>
                <th>Razão</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Operações</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@item.Cnpj</td>
                    <td>@item.Razao</td>
                    <td>@item.Telefone</td>
                    <td>@item.Email</td>
                    <td>
                        <a href="#" class="mdi mdi-pencil btn btn-success" onclick="PreencheEdit(@item.Id)" style="width:auto" data-toggle="modal" data-target="#modaleditFornecedor">Editar</a>
                        <a href="#" class="mdi mdi-note  btn btn-success" onclick="PreencheDetalhe(@item.Id)" data-toggle="modal" data-target="#modaldetalhesFornecedor">Detalhes</a>
                        <a href="#" class="mdi mdi-delete btn btn-danger" onclick="PreencheDelete(@item.Id)" data-toggle="modal" data-target="#modaldeleteFornecedor"></a>
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            @*<tr>
                    <td colspan="5">Quantidade de clientes: @Model.Count() </td>
                </tr>*@
        </tfoot>
    </table>
</div>

<!--Modal Create-->

<script type="text/javascript">
    function fMasc(objeto, mascara) {
        obj = objeto
        masc = mascara
        setTimeout("fMascEx()", 1)
    }
    function fMascEx() {
        obj.value = masc(obj.value)
    }
    function mTel(tel) {
        tel = tel.replace(/\D/g, "")
        tel = tel.replace(/^(\d)/, "($1")
        tel = tel.replace(/(.{3})(\d)/, "$1)$2")
        if (tel.length == 9) {
            tel = tel.replace(/(.{1})$/, "-$1")
        } else if (tel.length == 10) {
            tel = tel.replace(/(.{2})$/, "-$1")
        } else if (tel.length == 11) {
            tel = tel.replace(/(.{3})$/, "-$1")
        } else if (tel.length == 12) {
            tel = tel.replace(/(.{4})$/, "-$1")
        } else if (tel.length > 12) {
            tel = tel.replace(/(.{4})$/, "-$1")
        }
        return tel;
    }
    function mCNPJ(cnpj) {
        cnpj = cnpj.replace(/\D/g, "")
        cnpj = cnpj.replace(/^(\d{2})(\d)/, "$1.$2")
        cnpj = cnpj.replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3")
        cnpj = cnpj.replace(/\.(\d{3})(\d)/, ".$1/$2")
        cnpj = cnpj.replace(/(\d{4})(\d)/, "$1-$2")
        return cnpj
    }
</script>




<div class="modal fade" id="modalcreateFornecedor" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="exampleModalLabel">Cadastro de Fornecedor</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-horizontal col-md-12">
                    <div class="row" style="align-self:center">
                        <div class="form-group col-md-4">
                            <label>Razão:</label>
                            <input type="text" id="txtrazao" class="form-control" />
                        </div>

                        <div class="form-group col-md-4">
                            <label>Cnpj:</label>
                            <input type="text" minlength='18' maxlength='18' name="cnpj" onkeydown="javascript: fMasc( this, mCNPJ );" id="txtcnpj" class="form-control" />
                        </div>

                        <div class="form-group col-md-4">
                            <label>Telefone:</label>
                            <input type="text" minlength='14' maxlength='14' name="tel" onkeydown="javascript: fMasc( this, mTel );" id="txttelefone" class="form-control" />
                        </div>

                        <div class="form-group col-md-4">
                            <label>Email:</label>
                            <input type="text" id="txtemail" class="form-control" />
                        </div>

                        <div class="form-group col-md-8">
                            <label>Endereço:</label>
                            <input type="text" id="txtendereco" class="form-control" />
                        </div>

                        <br />
                        <div class="form-group col-md-12">

                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success mdi mdi-floppy" style="margin-right:25%; width:50%" onclick="Cadastrar()" id="btncadastro">
                    Cadastrar Fornecedor
                </button>
            </div>
        </div>
    </div>
</div>

<!--Modal edição-->
<div class="modal fade" id="modaleditFornecedor" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="edicao">Edição do Fornecedor </h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <div class="row">

                    <input type="hidden" id="txtidedicao" class="form-control" />

                    <div class="form-group col-md-4">
                        <label>Razão:</label>
                        <input type="text" id="txteditrazao" class="form-control" />
                    </div>

                    <div class="form-group col-md-4">
                        <label>Cnpj:</label>
                        <input type="text" minlength='18' maxlength='18' name="cnpj" onkeydown="javascript: fMasc( this, mCNPJ );" id="txteditcnpj" class="form-control" />
                    </div>

                    <div class="form-group col-md-4">
                        <label>Telefone:</label>
                        <input type="text" minlength='14' maxlength='14' name="tel" onkeydown="javascript: fMasc( this, mTel );" id="txtedittelefone" class="form-control" />
                    </div>

                    <div class="form-group col-md-4">
                        <label>Email:</label>
                        <input type="text" id="txteditemail" class="form-control" />
                    </div>

                    <div class="form-group col-md-8">
                        <label>Endereço:</label>
                        <input type="text" id="txteditendereco" class="form-control" />
                    </div>

                    <br />
                    <div class="form-group col-md-12">

                    </div>
                </div>


            </div>
            <div class="modal-footer">
                <button class="btn btn-success mdi mdi-update" style="margin-right:25%; width:50%" onclick="Editar()" id="btncadastro">
                    Atualizar Fornecedor
                </button>
            </div>
        </div>
    </div>
</div>
<!--Modal detalhe-->
<div class="modal fade" id="modaldetalhesFornecedor" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="edicao">Detalhe do Fornecedor</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="form-group col-md-4">
                        <label>Razão:</label>
                        <input type="text" id="txtdtrazao" class="form-control" readonly />
                    </div>

                    <div class="form-group col-md-4">
                        <label>Cnpj:</label>
                        <input type="text" id="txtdtcnpj" class="form-control" readonly />
                    </div>

                    <div class="form-group col-md-4">
                        <label>Telefone:</label>
                        <input type="text" id="txtdttelefone" class="form-control" readonly />
                    </div>

                    <div class="form-group col-md-4">
                        <label>Email:</label>
                        <input type="text" id="txtdtemail" class="form-control" readonly />
                    </div>

                    <div class="form-group col-md-8">
                        <label>Endereço:</label>
                        <input type="text" id="txtdtendereco" class="form-control" readonly />
                    </div>

                    <div class="form-group col-md-12">

                    </div>

                </div>
            </div>
            <div class="modal-footer">

            </div>
        </div>
    </div>
</div>

<!--Modal Delete-->
<div class="modal fade" id="modaldeleteFornecedor" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="delete">Deseja realmente excluir este Fornecedor?</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" class="form-control hidde" id="txtdeleteid" />
                <p style="color:orangered;text-align:center"> Aviso: Com esta ação os dados do Fornecedor em questão serão excluidos permanentemente!</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-danger mdi mdi-delete" style="margin-right:25%; width:50%" onclick="Delete()">Excluir Fornecedor</button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {

            $("#tbconsulta").DataTable({
                responsive: true,
                "paging": false,
                "language": {
                    "lengthMenu": "",
                    "search": "Procurar",
                    "info": "Mostrando página _PAGE_  de _PAGE_ ",
                    "zeroRecords": "Nenhum registro encontrado !",
                    "infoFiltered": "",
                    "info": "",
                    "infoEmpty": "",
                    "paginate": {
                        "first": "Primeiro",
                        "last": "Ultimo",
                        "next": "Próximo",
                        "previous": "Anterior"
                    }
                }
            });

            $("#btncadastro").click(function () {

                showAndDismissAlert('danger', 'Erro !!!');

            });
        })

        function Cadastrar() {
            model = {
                Id: null,
                Razao: $("#txtrazao").val(),
                Cnpj: $("#txtcnpj").val(),
                Telefone: $("#txttelefone").val(),
                Email: $("#txtemail").val(),
                Endereco: $("#txtendereco").val()
            }

            $.ajax({
                type: "POST",
                url: "/Fornecedor/Cadastrar",
                data: model,
                success: function () {
                    window.location.reload()
                },
                error: function (e) {

                    $("#mensagem").html("Erro: " + e.status);
                }
            });
        }
        function PreencheEdit(id) {
            $.ajax({
                type: "POST",
                url: "/Fornecedor/Editar",
                data: "id=" + id,
                success: function (model) {

                    $("#txtidedicao").val(id);
                    $("#txteditrazao").val(model.Razao);
                    $("#txteditcnpj").val(model.Cnpj);
                    $("#txtedittelefone").val(model.Telefone);
                    $("#txteditemail").val(model.Email);
                    $("#txteditendereco").val(model.Endereco);
                },
                error: function (e) {

                    $("#mensagem").html("Erro: " + e.status);
                }
            });
        }
        function PreencheDetalhe(id) {
            $.ajax({
                type: "POST",
                url: "/Fornecedor/Detalhe",
                data: "id=" + id,
                success: function (model) {
                    $("#txtdtrazao").val(model.Razao);
                    $("#txtdtcnpj").val(model.Cnpj);
                    $("#txtdttelefone").val(model.Telefone);
                    $("#txtdtemail").val(model.Email);
                    $("#txtdtendereco").val(model.Endereco);

                },
                error: function (e) {

                    $("#mensagem").html("Erro: " + e.status);
                }
            });
        }
        function Editar() {
            model = {
                Id: $("#txtidedicao").val(),
                Razao: $("#txteditrazao").val(),
                Cnpj: $("#txteditcnpj").val(),
                Telefone: $("#txtedittelefone").val(),
                Email: $("#txteditemail").val(),
                Endereco: $("#txteditendereco").val(),
            }

            $.ajax({
                type: "POST",
                url: "/Fornecedor/Edit",
                data: model,
                success: function () {
                    window.location.reload()
                },
                error: function (e) {

                    $("#mensagem").html("Erro: " + e.status);
                }
            });
        }
        function Delete() {
            id = $("#txtdeleteid").val();
            $.ajax({
                type: "POST",
                url: "/Fornecedor/Excluir",
                data: "id=" + id,
                success: function () {
                    window.location.reload()
                },
                error: function (e) {

                    $("#mensagem").html("Erro: " + e.status);
                }
            });
        }
        function PreencheDelete(id) {

            $("#txtdeleteid").val(id);
        }
    </script>
} 